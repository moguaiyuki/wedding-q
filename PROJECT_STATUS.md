# 結婚式クイズアプリ - プロジェクト設定状況

最終更新: 2025-08-26

## デプロイメント情報

### 本番環境
- **URL**: https://wedding-q.vercel.app
- **GitHubリポジトリ**: https://github.com/moguaiyuki/wedding-q
- **Vercelプロジェクト**: yuki-otsukas-projects/wedding-q
- **プロジェクトID**: prj_TdMgvHbtOB08JfhYlPJWsVp2csch
- **リージョン**: 東京 (hnd1)
- **公開設定**: Public (誰でもアクセス可能)

### 環境変数 (設定済み)
- ✅ `NEXT_PUBLIC_SUPABASE_URL` - Supabase接続URL
- ✅ `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase公開キー
- ✅ `SUPABASE_SERVICE_ROLE_KEY` - Supabaseサービスロールキー
- ✅ `ADMIN_PASSWORD` - 管理者パスワード
- ✅ `NEXT_PUBLIC_APP_URL` - https://wedding-q.vercel.app

## Supabase設定

### プロジェクト情報
- **プロジェクト名**: Wedding Q
- **プロジェクトID**: mfnkluhblmvneblbfldr
- **リージョン**: ap-northeast-1 (東京)
- **データベースバージョン**: PostgreSQL 17.4.1

### データベーステーブル構成
1. **users** - 参加者情報
   - QRコード、名前、グループ属性、座席番号
   - RLSポリシー設定済み

2. **questions** - クイズ問題
   - 問題文、問題タイプ、画像URL、配点
   - 削除・編集機能実装済み

3. **choices** - 選択肢
   - 問題に紐づく選択肢

4. **answers** - 回答記録
   - ユーザーの回答データ

5. **game_state** - ゲーム状態管理
   - 現在の問題番号、ゲーム状態

6. **user_sessions** - セッション管理
   - 再接続対応

### RLSポリシー
- すべてのテーブルでRow Level Security有効
- 参加者は自分のデータのみ操作可能
- 管理者（service_role/anon）は全データ操作可能

## 実装済み機能

### 基本機能 ✅
1. **認証システム**
   - 管理者: パスワード認証
   - 参加者: QRコード/ID認証（自動ログイン対応）

2. **参加者機能**
   - QRコード読み取り → 自動ログイン
   - クイズ回答
   - リアルタイム結果表示
   - セッション永続化（リロード対応）

3. **管理者機能**
   - 問題管理（追加・編集・削除）
   - 参加者管理
   - ゲーム進行制御
   - UNDO機能
   - データ初期化

4. **プレゼンテーション画面**
   - リアルタイム問題表示
   - 集計結果表示
   - ランキング表示

### 技術的な実装 ✅
- **リアルタイム同期**: Supabase Realtime
- **QRコード生成**: URL形式（https://wedding-q.vercel.app/participant?qr=XXXX）
- **自動再接続**: 3秒後のリトライ機能
- **レスポンシブデザイン**: モバイルファースト
- **日本語対応**: 全UI要素日本語化
- **エラーハンドリング**: ErrorBoundary実装

## 最近の更新内容 (2025-08-26)

### 機能追加・修正
1. **問題の削除・編集機能を実装**
   - PUT/DELETEメソッドをAPIに追加
   - 管理画面で編集・削除ボタンを追加

2. **削除機能のバグ修正**
   - RLSポリシーにanonロールのDELETE権限を追加

3. **UI/UXの改善**
   - 入力フィールドのテキスト色を修正（白→グレー）
   - ボタンのテキスト色を修正（視認性向上）

4. **QRコード機能の改善**
   - QRコードにURLを埋め込み（読み取り→自動遷移）
   - URLパラメータからの自動ログイン実装

5. **ビルドエラーの修正**
   - useSearchParamsをSuspense境界でラップ
   - Playwrightファイルをビルド対象から除外

6. **制限時間機能の削除**
   - time_limit_secondsフィールドを削除
   - タイマー表示を削除

## テスト環境

### ローカル開発
```bash
npm run dev      # 開発サーバー起動
npm run build    # ビルド
npm run lint     # ESLint実行
```

### E2Eテスト (Playwright)
- 60人同時接続テスト実装済み
- 管理者フロー、参加者フローのテスト実装済み
```bash
npm run test:e2e
```

## 運用ガイド

### 結婚式当日の流れ
1. **事前準備**
   - 参加者登録（60名）
   - QRコード印刷・座席配置
   - 問題登録

2. **リハーサル**
   - データ管理 → 回答データ初期化
   - テスト実施
   - 本番前に再度初期化

3. **本番運用**
   - プレゼンテーション画面をプロジェクターに投影
   - 参加者はQRコードを読み取って参加
   - 管理者ダッシュボードでゲーム進行

### トラブルシューティング
- **接続エラー**: WiFiとQRコードを確認
- **画面更新されない**: ページリロード
- **操作ミス**: UNDO機能で取り消し

## 次のステップ（未実装）

### 優先度：高
- 参加者のニックネーム設定機能
- 問題・解説の画像アップロード機能

### 優先度：中
- CSVによる参加者一括登録
- 最終結果のエクスポート機能

### 優先度：低
- 詳細な統計分析
- アニメーション効果の追加

## 連絡先・サポート
- GitHubリポジトリのIssuesで問題報告
- Vercelダッシュボードでログ確認
- Supabaseダッシュボードでデータ管理

---
このドキュメントは設定状況の記録用です。
最新の状態はVercelとSupabaseのダッシュボードで確認してください。